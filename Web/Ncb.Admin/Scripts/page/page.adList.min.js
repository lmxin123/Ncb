(function(n,t){"use strict";n.module("adApp",["ui.bootstrap"]).controller("AdCtrl",function(n,i){var u,e;n.pageSize=20;n.totalItems=0;n.currentPage=1;n.Ad={};n.DetailList={};n.checkState=0;n.getList=function(){i({method:"POST",url:"/adList/GetList",headers:{"Content-Type":undefined},transformRequest:function(i){return i=new FormData(t.getElementById("queryForm")),i.append("pageIndex",n.currentPage),i.append("pageSize",n.pageSize),i}}).success(function(t){t.Success?(t.Data.length===0&&common.alert("未查到数据！"),n.List=t.Data,n.totalItems=t.TotalCount,setTimeout(function(){$("[data-toggle='popover']").popover({html:!0,delay:{hide:200}})},10)):common.alert(t.Message||"获取数据失败！")}).error(function(){common.alert("出现错误或者网络异常");n.totalItems=0})};n.getDetailList=function(t){i.post("/adList/GetDetailList",{adID:t}).success(function(t){t.Success?(n.DetailList=t.Data,r.detailModel.modal("show")):common.alert(t.Message)}).error(function(n){common.alert(n.Message)})};var r={detailModel:$("#detailModal"),checkModal:$("#checkModal"),rContainer:$("#rContainer"),refusalReasonsContainer:$("#refusalReasonsContainer"),footerContainer:$("#footerContainer")},o=function(t){for(var i=0;i<n.List.length;i++)if(n.List[i].ID===t){n.Ad=n.List[i];break}},f=function(){n.Ad.RecordState===3?r.refusalReasonsContainer.show():r.refusalReasonsContainer.hide();n.Ad.RecordState===1?r.footerContainer.show():r.footerContainer.hide()};n.detailModal=function(t){n.getDetailList(t)};r.detailModel.on("hidden.bs.modal",function(){n.DetailList=null});n.RecordStates=2;n.check=function(t){o(t);f();n.getDetailList(t)};u=new AjaxClick(common.get("btnCheck"),{loadingText:"正在保存...",formSelector:"#checkForm",onBefore:function(){var n=$("#txtRefusal"),t;return!r.rContainer.hasClass("hidden")&&n.val()===""?(t="input-validation-error",n.addClass(t),n.keypress(function(){n.removeClass(t)}),!1):{id:$('[name="ID"]').val(),reasons:n.val(),checkState:$('[name="checkState"]:checked').val()}},onCompleted:function(t,i){t.Success?(n.getList(),n.Ad.RecordState=2,f(),$("#txtRefusal").val(""),common.alert("保存成功"),r.detailModel.modal("hide")):(i.reset(),common.alert("保存失败："+t.Message));u=i}});n.checkClick=function(){u.begin()};n.radioClick=function(n){n.target.value==="2"?r.rContainer.addClass("hidden"):r.rContainer.removeClass("hidden")};r.detailModel.on("hidden.bs.modal",function(){n.Ad=null;n.DetailList=null;u&&u.reset()});r.checkModal.on("hidden.bs.modal",function(){n.Ad=null});e=common.getUrlParameToJSON();e.isCancel&&n.getList()}).filter("areaFilter",function(){return exAreaCode}).filter("playTimeFilter",function(){return function(){var t=arguments[0],n=t.indexOf("，");return n=n===-1?t.indexOf(","):n,n===-1?t:t.substring(0,n)+"..."}})})(window.angular,document);