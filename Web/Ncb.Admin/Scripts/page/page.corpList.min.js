(function(n,t){"use strict";n.module("merchantListApp",["ui.bootstrap"]).controller("MerchantListCtrl",function(n,i){var r,u,f,e;n.pageSize=20;n.totalItems=0;n.currentPage=1;n.merchant={};n.getList=function(){i({method:"POST",url:"/corpList/getList",headers:{"Content-Type":undefined},transformRequest:function(i){return i=new FormData(t.getElementById("queryForm")),i.append("pageIndex",n.currentPage),i.append("pageSize",n.pageSize),i}}).success(function(t){t.Success?(t.Data.length===0&&common.alert("未查到数据！"),n.List=t.Data,n.totalItems=t.TotalCount):common.alert(t.Message||"获取数据失败！")}).error(function(){common.alert("出现错误或者网络异常！");n.totalItems=0})};r={detailModel:$("#detailModal"),checkModal:$("#checkModal")};u=function(t){for(var i=0;i<n.List.length;i++)if(n.List[i].ID===t){n.merchant=n.List[i];break}};n.detailModal=function(t){u(t);var f=n.merchant.Province,e=n.merchant.City,o=n.merchant.Region;n.merchant.AddressDisplay=exAreaCode(f)+exAreaCode(f,e)+exAreaCode(f,e,o)+n.merchant.Address;n.merchant.BusinessLicensePath?i.get("/corpList/GetBusinessLicense?filePath="+n.merchant.BusinessLicensePath).success(function(n){n.Success&&$("#bLContainer").empty().html("<img src="+n.Data+' width="100"/>');r.detailModel.modal("show")}):r.detailModel.modal("show")};n.RecordStates=2;n.check=function(n){u(n);r.checkModal.modal("show")};$("#btnCheck").ajaxClick({loadingText:"正在保存...",formSelector:"#checkForm",onBefore:function(){var n=$("#RefusalReasons"),t;if(!n.parents("div.form-group").hasClass("ng-hide")&&n.val()==="")return t="input-validation-error",n.addClass(t),n.keypress(function(){n.removeClass(t)}),!1},onCompleted:function(t,i){t.Success?(n.getList(),common.alert("保存成功"),r.checkModal.modal("hide")):(i.reset(),common.alert("保存失败："+t.Message));f=i}});n.radioClick=function(t){n.RecordStates=t.target.value};r.detailModel.on("hidden.bs.modal",function(){n.merchant=null});r.checkModal.on("hidden.bs.modal",function(){n.merchant=null;f&&f.reset()});e=common.getUrlParameToJSON();e.isCancel&&n.getList()}).filter("areaFilter",function(){return exAreaCode})})(window.angular,document);