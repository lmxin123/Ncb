+function(n){"use strict";n(function(){var t="input-validation-error",r=n("#openAreaContainer"),u=n("#playTimesContainer"),i=n("#fileContainer"),b=n("#Content"),c=n("#btnStartUpload"),k=n("#btnCreateAd"),l=common.getUrlParameToJSON(),d=n("#ID").val(),a=n("#OpenAreaValues").val(),v=n("#PlayTimeValues").val(),f=n("#createAdForm"),y=!1,g=function(){var t=[];a!==""&&(t=JSON.parse(a),t.length!==0)&&r.has("input")&&r.find("input").each(function(i,r){n.each(t,function(n,t){t.Value===r.value&&(r.checked=t.Checked)})})},nt=function(){var t=[];v!==""&&(t=JSON.parse(v),t.length!==0)&&u.has("input")&&u.find("input").each(function(i,r){n.each(t,function(n,t){t.Value===r.value&&(r.checked=t.Checked)})})},p=function(){var t=[],i=!0;return n('tbody.files input[type="text"]').each(function(){var r=n(this),u=r.val();u.isUrl()?(t.push({Name:r.attr("name"),RedirectUrl:r.val()}),common.clearValErrorMsg(r.attr("name"))):(i=!1,common.setValErrorMsg(null,r.attr("name"),"跳转地址无效"))}),n("#RedirectUrls").val(JSON.stringify(t)),i},s,w,h;setTimeout(function(){g();nt()},400);n.get("/adList/GetFileList",{adId:d},function(t){t.Data&&t.Data.length>0&&f.fileupload("option","done").call(f,n.Event("done"),{result:{files:t.Data}})});n.get("/adList/GetPlayTimesSelectorPartial",function(t){n("#playTimesContainer").html(t)},"html");var e=0,o=0,tt=f.fileupload({dataType:"json",maxNumberOfFiles:5,maxFileSize:209715200,acceptFileTypes:/(\.|\/)(gif|jpe?g|png|mp4|mpeg|mpg|avi|wmv|flv)$/i}).bind("fileuploadchange",function(n,t){e+=t.files?t.files.length:t.context.length}).bind("fileuploadfail",function(n,t){e-=t.files?t.files.length:t.context.length}).bind("fileuploadcompleted",function(n,t){y&&(o+=t.result.files.length,e===o&&(o=0,h.setLoadingText("保存成功",null,!0),l.aId||(common.alert("内容保存成功，3秒之后将刷新界面！",1e4),setTimeout(function(){location.reload()},3e3))))});n("#Region").change(function(){initOperArea()});s={minView:"month",format:"yyyy-mm-dd",language:"zh-CN",autoclose:!0};w=n("#EndPlayDate").datetimepicker(s);n("#BeginPlayDate").datetimepicker(s).on("changeDate",function(){w.datetimepicker("show")});c.click(function(){i.find(".files .start").trigger("click")});i.click(function(){b.removeClass(t);this.classList.remove(t)});k.ajaxClick({formSelector:"#createAdForm",loadingText:"正在上传文件...",onBefore:function(f){var o,e;h=f;f.$form.valid();o=n(".files");e=[];o.find("tr").length===0?(i.addClass(t),e.push("请选择内容文件！")):o.find(":disabled").length>0&&i.find(".error").text()!==""?(i.find(".error").each(function(){var i=n(this);i.text().trim().length&&i.parents("tr").addClass(t)}),e.push("请取消无效文件！")):i.find(".error").each(function(){var i=n(this);i.text().trim().length&&i.parents("tr").removeClass(t)});var s=n('[name="OpenArea"]:checked'),c=n('[name="PlayTime"]:checked'),l=[],a=[];return(s.length===0?(r.addClass(t),e.push("请选择播放区域！")):(s.each(function(t,i){l.push({Value:i.value,Checked:"Checked",Name:n.trim(n(i).parent().text())})}),r.removeClass(t)),c.length===0?(u.addClass(t),e.push("请选择播放时段！")):(c.each(function(t,i){a.push({Value:i.value,Checked:"Checked",Name:n.trim(n(i).parent().text())})}),u.removeClass(t)),p()||e.push("跳转地址无效！"),e.length>0)?(common.alert(e.join("<\/br>"),5e3),!1):{OpenAreas:JSON.stringify(l),PlayTimes:JSON.stringify(a)}},onSuccess:function(n){e>0?(common.alert("文件正在上传，请勿关闭窗口或者刷新界面！",3e3),f.fileupload("option","url",String.format("/adList/Upload?mId={0}&aId={1}",l.mId,n.Data)),p(),c.trigger("click"),y=!0):h.setLoadingText("保存成功",null,!0)}})})}($,document);