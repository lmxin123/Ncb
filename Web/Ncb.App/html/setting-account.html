<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--标准mui.css-->
		<link rel="stylesheet" href="../css/mui.min.css">
		<style>
			form {
				margin-top: 20px;
			}
			button{
				padding: 20px;
			}
		</style>
	</head>

	<body>
		<div class="mui-content">
			<div class="mui-content-padded">
				<form>
					<div class="mui-input-group">
						<div class="mui-input-row">
							<label>名称</label>
							<input type="text" id="txtName" class="mui-input-clear" placeholder="请输入名称">
						</div>
						<div class="mui-input-row">
							<label>手机号码</label>
							<input type="text" id="txtPhone" class="mui-input-clear" placeholder="请输入手机号码">
						</div>
					</div>
					<br />
					<button type="button" class="mui-btn mui-btn-primary mui-btn-block">
		        	保存</button>
				</form>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/common.js"></script>
		<script type="text/javascript" src="../js/ncb.app.js"></script>
		<script>
			mui.init();
			var flag = false;
			var name = document.getElementById('txtName'),
				phone = document.getElementById('txtPhone');
			mui.ready(function() {
					mui.getJSON(common.config.apiUrl + '', function(rsp) {
						if(rsp.Success) {
							name.value = rsp.Data.Name;
							phone.value = rsp.Data.PhoneNumber;
						} else {
							mui.toast(rsp.Message);
						}
					})
				}

			);
			var setAccount = function(callback) {
				flag = true;
				mui.showWaiting();
				mui.post(common.config.apiUrl + '', function(rsp) {
					if(rsp.Success) {
						mui.toast('保存成功！');
					} else {
						mui.toast(rsp.Message);
					}
					callback && callback();
				});
			};
			
			var oldBack = mui.back;
			mui.back = function() {
				if(!flag) {
					setAccount(oldBack);
				} else {
					oldBack();
				}
			};
		</script>
	</body>
</html>